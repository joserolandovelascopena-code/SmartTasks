<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="../../assets/icons/icon-192.png" type="image/png" />
    <title>Verificando cuenta...</title>
    <link rel="stylesheet" href="../../assets/css/autentication/verify.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>
  <body>
    <div class="verify-card" id="card">
      <div class="energy-core" id="core">
        <span></span>
        <span></span>
        <span></span>
        <div class="check">✓</div>
      </div>

      <h2 id="msg">Verificando cuenta</h2>
      <p id="sub">Validando credenciales de seguridad</p>
    </div>

    <script type="module">
      import { supabaseClient } from "../../assets/js/supabase.js";

      const card = document.getElementById("card");
      const core = document.getElementById("core");
      const msg = document.getElementById("msg");
      const sub = document.getElementById("sub");

      const hash = window.location.hash;
      const params = new URLSearchParams(hash.substring(1));

      const access_token = params.get("access_token");
      const refresh_token = params.get("refresh_token");

      if (!access_token || !refresh_token) {
        msg.textContent = "Enlace inválido o expirado";
        sub.textContent = "Vuelve a solicitar la verificación";
        throw new Error("No token");
      }

      await supabaseClient.auth.setSession({
        access_token,
        refresh_token,
      });

      card.classList.add("success");
      msg.textContent = "Cuenta verificada";
      sub.textContent = "Acceso confirmado";

      setTimeout(() => {
        card.classList.add("exit");
      }, 600);

      setTimeout(() => {
        window.location.href = "../../index.html";
      }, 1800);
    </script>
  </body>
</html>
